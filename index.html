<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Realtime GPS Tracking</title>
<style>
  body, html { margin:0; padding:0; height:100%; }
  #map { width: 100%; height: 100%; }
  #info {
    position: absolute;
    top: 10px; left: 50%;
    transform: translateX(-50%);
    background: rgba(255,255,255,0.9);
    padding: 10px 20px;
    font-family: sans-serif;
    font-size: 16px;
    border-radius: 8px;
    box-shadow: 0 0 5px #333;
    z-index: 10;
  }
</style>
</head>
<body>

<div id="info">Chờ dữ liệu GPS...</div>
<div id="map"></div>

<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY"></script>
<script>
let map;
let marker;
let infoDiv = document.getElementById('info');

// Khởi tạo map
function initMap() {
    const initialPos = { lat: 20.93, lng: 105.70 }; // vị trí mặc định
    map = new google.maps.Map(document.getElementById('map'), {
        center: initialPos,
        zoom: 15
    });
    marker = new google.maps.Marker({
        position: initialPos,
        map: map,
        title: "Thiết bị GPS"
    });
}

initMap();

// ==== Kết nối WebSocket để nhận GPS realtime ====
let ws = new WebSocket("wss://YOUR_SERVER_ADDRESS"); // thay bằng server của bạn

ws.onopen = () => {
    console.log("WebSocket connected");
};

ws.onmessage = (event) => {
    try {
        // Server gửi dữ liệu JSON: { "lat":20.93, "lon":105.70, "time":"11:03:48" }
        const data = JSON.parse(event.data);
        const lat = parseFloat(data.lat);
        const lon = parseFloat(data.lon);

        if (!isNaN(lat) && !isNaN(lon)) {
            const pos = { lat: lat, lng: lon };
            marker.setPosition(pos);
            map.panTo(pos);
            infoDiv.textContent = `Vị trí: ${lat.toFixed(6)}, ${lon.toFixed(6)} | Thời gian: ${data.time}`;
        }
    } catch(e) {
        console.error("Dữ liệu không hợp lệ:", event.data);
    }
};

ws.onclose = () => { console.log("WebSocket disconnected"); };
ws.onerror = (err) => { console.error("WebSocket error:", err); };

// ==== Nếu chưa có WebSocket, có thể thay bằng AJAX polling ====
// setInterval(() => {
//   fetch("https://your-server.com/latest-gps")
//     .then(res => res.json())
//     .then(data => {
//         const lat = parseFloat(data.lat);
//         const lon = parseFloat(data.lon);
//         if (!isNaN(lat) && !isNaN(lon)) {
//             const pos = { lat: lat, lng: lon };
//             marker.setPosition(pos);
//             map.panTo(pos);
//             infoDiv.textContent = `Vị trí: ${lat.toFixed(6)}, ${lon.toFixed(6)} | Thời gian: ${data.time}`;
//         }
//     });
// }, 5000); // polling 5 giây
</script>
</body>
</html>
